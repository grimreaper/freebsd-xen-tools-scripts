- Make it worthy of inclusion in xen-tools port

Yeah, some major cleanup because all of this is ugly and looks
like it was written in a workplace where people hate themselves.
